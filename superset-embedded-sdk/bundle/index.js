!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.supersetEmbeddedSdk=t():e.supersetEmbeddedSdk=t()}(globalThis,(()=>(()=>{"use strict";var __webpack_modules__={98:(module,__webpack_exports__,__webpack_require__)=>{var enterModule;__webpack_require__.d(__webpack_exports__,{g:()=>Switchboard}),module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},Actions;function isGet(e){return e.switchboardAction===Actions.GET}function isReply(e){return e.switchboardAction===Actions.REPLY}function isEmit(e){return e.switchboardAction===Actions.EMIT}function isError(e){return e.switchboardAction===Actions.ERROR}!function(e){e.GET="get",e.REPLY="reply",e.EMIT="emit",e.ERROR="error"}(Actions||(Actions={}));class Switchboard{constructor(e){this.port=void 0,this.name="",this.methods={},this.incrementor=1,this.debugMode=void 0,this.isInitialised=void 0,e&&this.init(e)}init(e){if(this.isInitialised)return void this.logError("already initialized");const{port:t,name:r="switchboard",debug:o=!1}=e;this.port=t,this.name=r,this.debugMode=o,t.addEventListener("message",(async e=>{this.log("message received",e);const t=e.data;if(isGet(t))this.port.postMessage(await this.getMethodResult(t));else if(isEmit(t)){const{method:e,args:r}=t,o=this.methods[e];o&&o(r)}})),this.isInitialised=!0}async getMethodResult(e){let{messageId:t,method:r,args:o}=e;const s=this.methods[r];if(null==s)return{switchboardAction:Actions.ERROR,messageId:t,error:`[${this.name}] Method "${r}" is not defined`};try{const e=await s(o);return{switchboardAction:Actions.REPLY,messageId:t,result:e}}catch(e){return this.logError(e),{switchboardAction:Actions.ERROR,messageId:t,error:`[${this.name}] Method "${r}" threw an error`}}}defineMethod(e,t){this.methods[e]=t}get(e,t){return void 0===t&&(t=void 0),new Promise(((r,o)=>{if(!this.isInitialised)return void o(new Error("Switchboard not initialised"));const s=this.getNewMessageId(),a=e=>{const t=e.data;if(t.messageId===s)if(this.port.removeEventListener("message",a),isReply(t))r(t.result);else{const e=isError(t)?t.error:"Unexpected response message";o(new Error(e))}};this.port.addEventListener("message",a),this.port.start();const i={switchboardAction:Actions.GET,method:e,messageId:s,args:t};this.port.postMessage(i)}))}emit(e,t){if(void 0===t&&(t=void 0),!this.isInitialised)return void this.logError("Switchboard not initialised");const r={switchboardAction:Actions.EMIT,method:e,args:t};this.port.postMessage(r)}start(){this.isInitialised?this.port.start():this.logError("Switchboard not initialised")}log(){if(this.debugMode){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.debug(`[${this.name}]`,...t)}}logError(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.error(`[${this.name}]`,...t)}getNewMessageId(){return`m_${this.name}_${this.incrementor++}`}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}const _default=new Switchboard;var __WEBPACK_DEFAULT_EXPORT__=_default,reactHotLoader,leaveModule;reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(isGet,"isGet","/Users/ville/apple/apache-superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts"),reactHotLoader.register(isReply,"isReply","/Users/ville/apple/apache-superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts"),reactHotLoader.register(isEmit,"isEmit","/Users/ville/apple/apache-superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts"),reactHotLoader.register(isError,"isError","/Users/ville/apple/apache-superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts"),reactHotLoader.register(Switchboard,"Switchboard","/Users/ville/apple/apache-superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts"),reactHotLoader.register(_default,"default","/Users/ville/apple/apache-superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{embedDashboard:()=>p});const e="__embedded_comms__",t={visible:"show_filters",expanded:"expand_filters"};var r=__webpack_require__(98);function o(e){this.message=e}o.prototype=new Error,o.prototype.name="InvalidCharacterError";var s="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new o("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,s,a=0,i=0,n="";s=t.charAt(i++);~s&&(r=a%4?64*r+s:s,a++%4)?n+=String.fromCharCode(255&r>>(-2*a&6)):0)s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(s);return n};function a(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(s(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return s(t)}}function i(e){this.message=e}i.prototype=new Error,i.prototype.name="InvalidTokenError";const n=function(e,t){if("string"!=typeof e)throw new i("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(a(e.split(".")[r]))}catch(e){throw new i("Invalid token specified: "+e.message)}},d=5e3,c=1e4,l=3e5;function u(e){const t=n(e),r=new Date(/[^0-9\.]/g.test(t.exp)?t.exp:1e3*parseFloat(t.exp));return("Invalid Date"!==r.toString()?Math.max(c,r.getTime()-Date.now()):l)-d}async function p({id:o,supersetDomain:s,mountPoint:a,fetchGuestToken:i,dashboardUiConfig:n,debug:d=!1}){function c(...e){d&&console.debug(`[superset-embedded-sdk][dashboard ${o}]`,...e)}c("embedding"),s.endsWith("/")&&(s=s.slice(0,-1));const[l,p]=await Promise.all([i(),async function(){return new Promise((i=>{const l=document.createElement("iframe"),u=n?`?uiConfig=${function(){let e=0;return n&&(n.hideTitle&&(e+=1),n.hideTab&&(e+=2),n.hideChartControls&&(e+=8)),e}()}`:"",p=n?.filters||{},_=Object.keys(p),h=_.length>0?"&"+_.map((e=>t[e]+"="+p[e])).join("&"):"";l.sandbox.add("allow-same-origin"),l.sandbox.add("allow-scripts"),l.sandbox.add("allow-presentation"),l.sandbox.add("allow-downloads"),l.sandbox.add("allow-forms"),l.sandbox.add("allow-popups"),l.addEventListener("load",(()=>{const t=new MessageChannel,o=t.port1,a=t.port2;l.contentWindow.postMessage({type:e,handshake:"port transfer"},s,[a]),c("sent message channel to the iframe"),i(new r.g({port:o,name:"superset-embedded-sdk",debug:d}))})),l.src=`${s}/embedded/${o}${u}${h}`,a.replaceChildren(l),c("placed the iframe")}))}()]);return p.emit("guestToken",{guestToken:l}),c("sent guest token"),setTimeout((async function e(){const t=await i();p.emit("guestToken",{guestToken:t}),setTimeout(e,u(t))}),u(l)),{getScrollSize:()=>p.get("getScrollSize"),unmount:function(){c("unmounting"),a.replaceChildren()},getDashboardPermalink:e=>p.get("getDashboardPermalink",{anchor:e}),getActiveTabs:()=>p.get("getActiveTabs")}}})(),__webpack_exports__})()));
//# sourceMappingURL=index.js.map